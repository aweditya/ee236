import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

def f(x, m, c):
    return m*x + c

if __name__ == "__main__":
    vce_100 = np.array([0.008, 0.014, 0.018, 0.037, 0.047, 0.053, 0.063, 0.070, 0.075, 0.080, 0.085, 0.101, 0.187, 0.304, 0.401, 0.452, 0.605, 0.702, 0.846, 1.023, 1.467, 1.970])
    ice_100 = np.array([0.040, 0.149, 0.266, 0.868, 1.305, 1.711, 2.420, 2.910, 3.390, 3.820, 4.350, 6.210, 12.80, 14.97, 15.85, 16.78, 17.84, 18.47, 18.77, 19.04, 19.40, 20.1])
    
    vce_200 = np.array([0.010, 0.019, 0.030, 0.040, 0.048, 0.115, 0.205, 0.306, 0.406, 0.504, 0.601, 0.727, 0.813, 0.917, 0.988])
    ice_200 = np.array([0.228, 0.709, 1.480, 2.320, 3.110, 13.43, 23.40, 25.70, 27.10, 28.30, 29.50, 30.80, 31.90, 33.00, 33.50])

    vce_300 = np.array([0.010, 0.019, 0.028, 0.043, 0.050, 0.074, 0.099, 0.182, 0.230, 0.273, 0.296, 0.343, 0.392, 0.400])
    ice_300 = np.array([0.194, 1.105, 1.975, 3.810, 4.870, 9.460, 14.12, 27.40, 31.40, 32.70, 33.30, 34.00, 34.80, 35.10])

    vce_400 = np.array([0.010, 0.016, 0.022, 0.029, 0.034, 0.038, 0.043, 0.048, 0.054, 0.059, 0.073, 0.079, 0.089, 0.102, 0.108, 0.115, 0.126, 0.145, 0.179, 0.199])
    ice_400 = np.array([0.473, 1.089, 1.760, 2.810, 3.440, 4.050, 5.070, 5.890, 7.140, 8.120, 11.30, 12.54, 15.21, 18.70, 19.70, 21.10, 23.30, 27.60, 32.70, 34.80 ])

    plt.title("Output Characteristics of BJT in CE Configuration")
    plt.plot(vce_100, ice_100, label=r"$I_{B}=100{\mu}A$")
    plt.plot(vce_200, ice_200, label=r"$I_{B}=200{\mu}A$")
    plt.plot(vce_300, ice_300, label=r"$I_{B}=300{\mu}A$")
    plt.plot(vce_400, ice_400, label=r"$I_{B}=400{\mu}A$")
    plt.xlabel(r"$V_{CE}$")
    plt.ylabel(r"$I_{CE}$")
    plt.legend()
    plt.grid(linestyle = '--', linewidth = 0.5)
    plt.show()

    popt, _ = curve_fit(f, vce_100[-5:], ice_100[-5:])
    print("Early Voltage at 100uA:", -popt[1]/popt[0])
